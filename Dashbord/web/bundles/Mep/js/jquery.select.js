(function(b,c){var a=0;b.widget("ech.multiselect",{options:{header:true,height:175,minWidth:125,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:"",hide:"",autoOpen:false,multiple:true,width:0,position:{}},_create:function(){var g=this.element.hide(),i=this.options;this.speed=b.fx.speeds._default;this._isOpen=false;var f=(this.button=b('<button type="button"><span class="ui-icon-select ui-icon-triangle-2-n-select"></span></button>')).addClass("ui-multiselect-select ui-widget-select ui-state-default-select ui-corner-all-select").addClass(i.classes).attr({title:g.attr("title"),"aria-haspopup":true,tabIndex:g.attr("tabIndex")}).insertAfter(g),d=(this.buttonlabel=b("<span />")).html(i.noneSelectedText).appendTo(f),h=(this.menu=b("<div />")).addClass("ui-multiselect-menu-select ui-widget-select ui-widget-content-select ui-corner-all-select").addClass(i.classes).insertAfter(f),k=(this.header=b("<div />")).addClass("ui-widget-header-select ui-corner-all-select ui-multiselect-header-select ui-helper-clearfix-select").appendTo(h),e=(this.headerLinkContainer=b("<ul />")).addClass("ui-helper-reset-select").html(function(){if((i.header===true)||(i.header=="")){return'<li><a class="ui-multiselect-all-select" href="#"><span class="ui-icon-select ui-icon-check-select"></span><span>'+i.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon-select ui-icon-closethick"></span><span>'+i.uncheckAllText+"</span></a></li>"}else{if(typeof i.header==="string"){return"<li>"+i.header+"</li>"}else{return""}}}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"></a></li>').appendTo(k),j=(this.checkboxContainer=b("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset-select").appendTo(h);this._bindEvents();this.refresh(true);if(!i.multiple){h.addClass("ui-multiselect-single")}},_init:function(){if(this.options.header===false){this.header.hide()}if((typeof(this.options.header)!="string")&&(!this.options.multiple)){this.header.hide()}if((this.options.header=="")&&(!this.options.multiple)){this.header.hide()}if(!this.options.multiple){this.headerLinkContainer.find(".ui-multiselect-all-select, .ui-multiselect-none").hide()}if(this.options.autoOpen){this.open()}if(this.element.is(":disabled")){this.disable()}},refresh:function(i){var f=this.element,h=this.options,g=this.menu,k=this.checkboxContainer,d=[],e=[],j=f.attr("id")||a++;this.element.find("option").each(function(o){var p=b(this),t=this.parentNode,r=this.innerHTML,w=this.title,n=p.attr("class"),s=this.value,m=this.id||"ui-multiselect-"+j+"-option-"+o,v=this.disabled,l=this.selected,q=["ui-corner-all-select"],u;if(t.tagName.toLowerCase()==="optgroup"){u=t.getAttribute("label");if(b.inArray(u,d)===-1){e.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+u+"</a></li>");d.push(u)}}if(v){q.push("ui-state-disabled")}if(l&&!h.multiple){q.push("ui-state-active-select")}e.push('<li class="'+(v?"ui-multiselect-disabled":"")+'">');e.push('<label for="'+m+'" title="'+w+'" class="'+q.join(" ")+'">');e.push('<input id="'+m+'" name="multiselect_'+j+'" type="'+(h.multiple?"checkbox":"radio")+'" value="'+s+'" title="'+r+'"');if(l){e.push(' checked="checked"');e.push(' aria-selected="true"')}if(v){e.push(' disabled="disabled"');e.push(' aria-disabled="true"')}e.push(" /><span>"+r+"</span>");if((typeof(n)!="undefined")&&(n!="")){e.push('<span class="'+n+'"></span>')}e.push("</label></li>")});k.html(e.join(""));this.labels=g.find("label");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();if(!i){this._trigger("refresh")}},update:function(){var h=this.options,e=this.labels.find("input"),d=e.filter(":checked"),f=d.length,g;if(f===0){g=h.noneSelectedText}else{if(b.isFunction(h.selectedText)){g=h.selectedText.call(this,f,e.length,d.get())}else{if(/\d/.test(h.selectedList)&&h.selectedList>0&&f<=h.selectedList){g=d.map(function(){return this.title}).get().join(", ")}else{g=h.selectedText.replace("#",f).replace("#",e.length)}}}this.buttonlabel.html(g);return g},_bindEvents:function(){var d=this,e=this.button;function f(){d[d._isOpen?"close":"open"]();return false}e.find("span").bind("click.multiselect",f);e.bind({click:f,keypress:function(g){switch(g.which){case 27:case 38:case 37:d.close();break;case 39:case 40:d.open();break}},mouseenter:function(){if(!e.hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover-select")}},mouseleave:function(){b(this).removeClass("ui-state-hover-select")},focus:function(){if(!e.hasClass("ui-state-disabled")){b(this).addClass("ui-state-focus-select")}},blur:function(){b(this).removeClass("ui-state-focus-select")}});this.header.delegate("a","click.multiselect",function(g){if(b(this).hasClass("ui-multiselect-close")){d.close()}else{d[b(this).hasClass("ui-multiselect-all-select")?"checkAll":"uncheckAll"]()}g.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(k){k.preventDefault();var j=b(this),i=j.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),g=i.get(),h=j.parent().text();if(d._trigger("beforeoptgrouptoggle",k,{inputs:g,label:h})===false){return}d._toggleChecked(i.filter(":checked").length!==i.length,i);d._trigger("optgrouptoggle",k,{inputs:g,label:h,checked:g[0].checked})}).delegate("label","mouseenter.multiselect",function(){if(!b(this).hasClass("ui-state-disabled")){d.labels.removeClass("ui-state-hover-select");b(this).addClass("ui-state-hover-select").find("input").focus()}}).delegate("label","keydown.multiselect",function(g){g.preventDefault();switch(g.which){case 9:case 27:d.close();break;case 38:case 40:case 37:case 39:d._traverse(g.which,this);break;case 13:b(this).find("input")[0].click();break}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(j){var i=b(this),k=this.value,h=this.checked,g=d.element.find("option");if(this.disabled||d._trigger("click",j,{value:k,text:this.title,checked:h})===false){j.preventDefault();return}i.attr("aria-selected",h);g.each(function(){if(this.value===k){this.selected=h;if(h){this.setAttribute("selected","selected")}else{this.removeAttribute("selected")}}else{if(!d.options.multiple){this.selected=false}}});if(!d.options.multiple){d.labels.removeClass("ui-state-active-select");i.closest("label").toggleClass("ui-state-active-select",h);d.close()}d.element.trigger("change");setTimeout(b.proxy(d.update,d),10)});b(document).bind("mousedown.multiselect",function(g){if(d._isOpen&&!b.contains(d.menu[0],g.target)&&!b.contains(d.button[0],g.target)&&g.target!==d.button[0]){d.close()}});b(this.element[0].form).bind("reset.multiselect",function(){setTimeout(function(){d.update()},10)})},_setButtonWidth:function(){var d=this.element.outerWidth(),e=this.options;if(/\d/.test(e.minWidth)&&d<e.minWidth){d=e.minWidth}if(e.width!=0){d=e.width}this.button.width(d)},_setMenuWidth:function(){var d=this.menu,e=this.button.outerWidth()-parseInt(d.css("padding-left"),10)-parseInt(d.css("padding-right"),10)-parseInt(d.css("border-right-width"),10)-parseInt(d.css("border-left-width"),10);d.width(e||this.button.outerWidth())},_traverse:function(h,i){var f=b(i),e=h===38||h===37,d=f.parent()[e?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[e?"last":"first"]();if(!d.length){var g=this.menu.find("ul:last");this.menu.find("label")[e?"last":"first"]().trigger("mouseover");g.scrollTop(e?g.height():0)}else{d.find("label").trigger("mouseover")}},_toggleCheckbox:function(e,d){return function(){!this.disabled&&(this[e]=d);if(d){this.setAttribute("aria-selected",true)}else{this.removeAttribute("aria-selected")}}},_toggleChecked:function(d,h){var g=(h&&h.length)?h:this.labels.find("input"),f=this;g.each(this._toggleCheckbox("checked",d));this.update();var e=g.map(function(){return this.value}).get();this.element.find("option").each(function(){if(!this.disabled&&b.inArray(this.value,e)>-1){f._toggleCheckbox("selected",d).call(this)}});if(g.length){this.element.trigger("change")}},_toggleDisabled:function(d){this.button.attr({disabled:d,"aria-disabled":d})[d?"addClass":"removeClass"]("ui-state-disabled");this.menu.find("input").attr({disabled:d,"aria-disabled":d}).parent()[d?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:d,"aria-disabled":d})},open:function(i){var l=this,h=this.button,d=this.menu,g=this.speed,f=this.options;if(this._trigger("beforeopen")===false||h.hasClass("ui-state-disabled")||this._isOpen){return}var k=d.find("ul:last"),m=f.show,j=h.position();if(b.isArray(f.show)){m=f.show[0];g=f.show[1]||l.speed}k.scrollTop(0).css("max-height",f.height);k.scrollTop(0).css("height","auto");k.scrollTop(0).css("overflow","auto");if(b.ui.position&&!b.isEmptyObject(f.position)){f.position.of=f.position.of||h;d.show().position(f.position).hide().show(m,g)}else{d.show(m,g)}this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");h.addClass("ui-state-active-select");this._isOpen=true;this._trigger("open")},close:function(){if(this._trigger("beforeclose")===false){return}var f=this.options,d=f.hide,e=this.speed;if(b.isArray(f.hide)){d=f.hide[0];e=f.hide[1]||this.speed}this.menu.hide(d,e);this.button.removeClass("ui-state-active-select").trigger("blur").trigger("mouseleave");this._isOpen=false;this._trigger("close")},enable:function(){this._toggleDisabled(false)},disable:function(){this._toggleDisabled(true)},checkAll:function(d){this._toggleChecked(true);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(false);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){b.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},_setOption:function(d,e){var f=this.menu;switch(d){case"header":f.find("div.ui-multiselect-header-select")[e?"show":"hide"]();break;case"checkAllText":f.find("a.ui-multiselect-all-select span").eq(-1).text(e);break;case"uncheckAllText":f.find("a.ui-multiselect-none span").eq(-1).text(e);break;case"height":f.find("ul:last").css("max-height",parseInt(e,10));f.find("ul:last").css("height","auto");break;case"minWidth":this.options[d]=parseInt(e,10);this._setButtonWidth();this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[d]=e;this.update();break;case"classes":f.add(this.button).removeClass(this.options.classes).addClass(e);break}b.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);(function(a){var b=/[\-\[\]{}()*+?.,\\^$|#\s]/g;a.widget("ech.multiselectfilter",{options:{label:"Filter:",width:null,placeholder:"Enter keywords"},_create:function(){var d=this,e=this.options,c=(this.instance=a(this.element).data("multiselect")),g=(this.header=c.menu.find(".ui-multiselect-header-select").addClass("ui-multiselect-hasfilter-select")),f=(this.wrapper=a('<div class="ui-multiselect-filter-select">'+(e.label.length?e.label:"")+'<input placeholder="'+e.placeholder+'" type="search"'+(/\d/.test(e.width)?'style="width:'+e.width+'px"':"auto !important")+" /></div>").prependTo(this.header));this.inputs=c.menu.find('input[type="checkbox"], input[type="radio"]');this.input=f.find("input").bind({keydown:function(h){if(h.which===13){h.preventDefault()}},keyup:a.proxy(d._handler,d),click:a.proxy(d._handler,d)});this.updateCache();c._toggleChecked=function(j,m){var l=(m&&m.length)?m:this.labels.find("input"),i=this,h=d.instance._isOpen?":disabled, :hidden":":disabled";l=l.not(h).each(this._toggleCheckbox("checked",j));this.update();var k=l.map(function(){return this.value}).get();this.element.find("option").filter(function(){if(!this.disabled&&a.inArray(this.value,k)>-1){i._toggleCheckbox("selected",j).call(this)}})};a(document).bind("multiselectrefresh",function(){d.updateCache();d._handler()})},_handler:function(i){var f=a.trim(this.input[0].value.toLowerCase()),h=this.rows,c=this.inputs,d=this.cache;if(!f){h.show()}else{h.hide();var g=new RegExp(f.replace(b,"\\$&"),"gi");this._trigger("filter",i,a.map(d,function(e,j){if(e.search(g)!==-1){h.eq(j).show();return c.get(j)}return null}))}this.instance.menu.find(".ui-multiselect-optgroup-label").each(function(){var e=a(this);e[e.nextUntil(".ui-multiselect-optgroup-label").filter(":visible").length?"show":"hide"]()})},updateCache:function(){this.rows=this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)");this.cache=this.element.children().map(function(){var c=a(this);if(this.tagName.toLowerCase()==="optgroup"){c=c.children()}return c.map(function(){return this.innerHTML.toLowerCase()}).get()}).get()},widget:function(){return this.wrapper},destroy:function(){a.Widget.prototype.destroy.call(this);this.input.val("").trigger("keyup");this.wrapper.remove()}})})(jQuery);